<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Website Privacy Score Detector</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="background-anim">
    <div class="blob blob1"></div>
    <div class="blob blob2"></div>
  </div>
  <nav class="navbar navbar-dark px-4 mb-4 shadow rounded-navbar">
    <span class="navbar-brand mb-0 h1 d-flex align-items-center">
      <img src="https://img.icons8.com/fluency/48/security-checked.png" alt="" class="brand-logo"/>
      <span>Privacy Score Detector</span>
    </span>
  </nav>
  <div class="container py-5">
    <div class="card shadow-lg main-card p-4">
      <h5 class="mb-4 text-center title-glow">üõ°Ô∏è Check Website Security & Privacy</h5>
      <div class="input-group mb-3">
        <input type="text" id="urlInput" class="form-control stylish-input" placeholder="Paste a website URL (e.g. https://example.com)" />
        <button id="analyzeBtn" class="btn btn-primary px-4 stylish-btn">Analyze</button>
      </div>
      <!-- Results box will be inserted dynamically by JS -->
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
const analyzeBtn = document.getElementById("analyzeBtn");

analyzeBtn.addEventListener("click", async function() {
  const urlInput = document.getElementById("urlInput");
  const url = urlInput.value.trim();
  const card = document.querySelector(".main-card");

  // Remove any old results
  const oldResult = document.getElementById("result-box");
  if (oldResult) oldResult.remove();

  // Helper to display result
  function showResult(html) {
    const div = document.createElement("div");
    div.id = "result-box";
    div.className = "mt-4 animate-in";
    div.innerHTML = html;
    card.appendChild(div);
  }

  if (!url) {
    showResult(`<div class="error-msg">‚ö†Ô∏è Please enter a valid website URL.</div>`);
    return;
  }

  // Show loading message
  showResult(`<div class="loading-msg">üîé Analyzing website... please wait</div>`);

try {
  const response = await fetch("http://localhost:8080/analyze", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ website: url })
  });

  if (!response.ok) throw new Error(`Server error: ${response.status}`);

  const data = await response.json();

  // ‚úÖ Instead of creating another div, reuse the same one:
  const resultBox = document.getElementById("result-box");
  if (resultBox) resultBox.innerHTML = `
    <div class="results-glass">
      <div class="score-row">
        <div class="score-circle">${data.privacyGrade}</div>
        <div class="ml-3" style="padding-top:1.4rem;">
          ${
            data.privacyGrade === "A+" || data.privacyGrade === "A"
              ? `<span class="risk-low"><span class="icon">üü¢</span>A+ Secure</span>`
              : data.privacyGrade === "B"
              ? `<span class="risk-medium"><span class="icon">üü°</span>B Moderate</span>`
              : `<span class="risk-high"><span class="icon">üîµ</span>${data.privacyGrade || "C"} Risk</span>`
          }
        </div>
      </div>
      <div class="summary mt-3 mb-2">${data.analysisSummary}</div>
      <div class="small text-secondary mb-2" style="font-style:italic;color:#90caf9;">${data.examples}</div>
      <table class="mb-2">
        <tr><th>Cookies</th><td>${data.cookiesFound}</td></tr>
        <tr><th>Third-party domains</th><td>${data.thirdPartyFound}</td></tr>
        <tr><th>Storage entries</th><td>${data.storageFound}</td></tr>
      </table>
      ${
        data.thirdPartyDomains && data.thirdPartyDomains.length > 0
          ? `<h6>3rd Parties Detected:</h6><ul>${data.thirdPartyDomains
              .slice(0, 5)
              .map(d => `<li>${d}</li>`)
              .join("")}</ul>`
          : ""
      }
    </div>
  `;
} catch (err) {
  const resultBox = document.getElementById("result-box");
  if (resultBox) resultBox.innerHTML = `<div class="error-msg">‚ùå Error: ${err.message}</div>`;
}
});
</script>


</body>
</html>
